{% extends "layouts/base.html" %}
{% block title %}Credenciais Google - Tutorial{% endblock %}
{% block content %}
<h2>Credenciais do Google</h2>

<section>
  <h3>Tutorial rápido (resumido)</h3>
  <ol>
    <li>Acesse: <a href="https://console.cloud.google.com/apis/credentials" target="_blank" rel="noopener">Google Cloud Console → APIs e serviços → Credenciais</a>.</li>
    <li>Se necessário, clique em "Tela de permissão OAuth" e preencha/publique o consentimento (nome do app, e-mail de contato). Volte a "Credenciais".</li>
    <li>Clique em <strong>+ Criar credenciais → ID do cliente OAuth</strong>.</li>
    <li>Escolha o tipo:
      <ul>
        <li><strong>Computador / Desktop</strong> (recomendado para gerar refresh_token manualmente — é mais simples).</li>
        <li><strong>Aplicação Web</strong> se quiser usar fluxo com redirect URI (requer configurar URI de callback e implementar rota).</li>
      </ul>
    </li>
    <li>Ao criar, copie o <em>Client ID</em> e <em>Client Secret</em> (client_id tem formato parecido com <code>xxxxx.apps.googleusercontent.com</code> — não é um e‑mail).</li>
    <li>Gere um <em>refresh_token</em> para sua conta admin usando uma das opções abaixo e cole-o no formulário:</li>
  </ol>
</section>

<section>
  <h4>Opção A — OAuth Playground (mais simples, sem código)</h4>
  <ol>
    <li>Acesse <a href="https://developers.google.com/oauthplayground" target="_blank" rel="noopener">OAuth 2.0 Playground</a>.</li>
    <li>Nas configurações (ícone de engrenagem), marque <em>Use your own OAuth credentials</em> e cole seu Client ID e Client Secret.</li>
    <li>Na lista de APIs, selecione os scopes que precisa (ex.: <code>https://www.googleapis.com/auth/drive.readonly</code> e/ou <code>https://www.googleapis.com/auth/drive.metadata.readonly</code>), clique em "Authorize APIs".</li>
    <li>Conceda permissão com a sua conta admin; clique em "Exchange authorization code for tokens".</li>
    <li>Copie o campo <strong>Refresh token</strong> e cole na interface /admin/google-credentials.</li>
  </ol>
  <p>Vantagem: sem instalar nada, rápido e seguro se você estiver no seu próprio navegador.</p>
</section>

<section>
  <h4>Opção B — Script Python (fluxo "Desktop")</h4>
  <p>Baixe o JSON do client (ou crie um arquivo <code>client_secret.json</code>) e execute o script Python que irá abrir uma URL, autorizar e retornar o refresh_token. Script de exemplo abaixo (salve como <code>get_refresh_token.py</code> e rode localmente).</p>
</section>

<section>
  <h4>Boas práticas de segurança</h4>
  <ul>
    <li>Armazene client_secret e refresh_token apenas no servidor, em arquivo protegido (chmod 600) ou em secret manager. Não publique em repositório.</li>
    <li>Restrinja acesso à página /admin/google-credentials apenas a administradores.</li>
    <li>Registre o uso do token e audite chamadas sensíveis (os logs do Google mostrarão ações em nome do admin).</li>
    <li>Considere migrar para uma Service Account no futuro e compartilhar pastas/recursos com ela (melhor isolamento).</li>
  </ul>
</section>

<section style="margin-top:1rem;">
  <p><em>Quando você já tiver o client_id/client_secret e o refresh_token, cole-os no formulário abaixo para salvar no servidor.</em></p>
</section>
{% endblock %}